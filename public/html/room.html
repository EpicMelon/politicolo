<!DOCTYPE html>
<html>
  <head>
    <title>De kamer!</title>
    <link rel="stylesheet" type="text/css" href="../css/roomstyle.css" />
  </head>

  <body>
    <center><h1 id="roomname"> De 1829ste kamer</h1>
      <h4 id="users online"  style="color:rgb(28, 182, 36); margin-top:-30px"> (Je bent alleen)</h2> </center>

    <center><h3>
      Deel deze link met je partij: <a href="#" id="link" target="_blank">Link</a>
    </h3></center>

    <center>
      <form id="username_form" action="">
        <input id="username_input" autocomplete="off" placeholder="thiery B">
        <button>Change name</button>
      </form>
    </center>

    <div id="quiz">
      <div><center><h2 id="question">Doe de Quiz!</h2></div>
      <ul id="answers">
      </ul>
      <button id="beginQuiz" onclick="startQuiz()">Begin quiz</button>

      <div class="slidecontainer">
        <input type="range" min="1" max="100" value="50" class="slider" id="myRange">
      </div>
    </div>

    <div id="chat">
      <ul id="messages"></ul>
      <form id="form" action="">
        <input id="input" autocomplete="off" /> 
        <button type="submit">Verstuur</button> 
        <button id="exit" type="button" style="color:red" onclick="toLobby()">Treed af</button>
      </form></center>
    </div>
  </body>



  <script type="text/javascript">
    window.onload = function(){
        document.getElementById("link").href = window.location.toString();
        document.getElementById("link").textContent = window.location.toString();
    }
  </script>

  <script src="../js/chat.js"> </script>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    var socket = io();

    var username_form = document.getElementById('username_form');
    var username_input = document.getElementById('username_input');

    var roomname_text = document.getElementById('roomname');
    var usersonline_text = document.getElementById('users online');
  
    var slider = document.getElementById("myRange");
    var output = document.getElementById("demo");

    function toLobby() {
      window.location = '/';
    }

    function startQuiz() {
      var elem = document.getElementById("beginQuiz");
      if (elem){
        elem.parentNode.removeChild(elem);
      }

      socket.emit('start game');
    }

    username_form.addEventListener('submit', function(e) {
      e.preventDefault();
      if (username_input.value) {
        socket.emit('set username', username_input.value);;
        username_input.value = '';
      }
    });

    var room_name = window.location.pathname.toString().split("/")[2];
    socket.emit('joinroom', room_name);

    document.title = room_name + "ste kamer";
    roomname_text.textContent = "de " + room_name + "ste kamer";

    socket.on("new user", function(data) {
      if ((data) == "1") {
        usersonline_text.textContent = "Je bent alleen";
      }
      else {
        usersonline_text.textContent = data + " kamerleden";
      }
    });

    socket.on('status message', function(msg) {
      var item = document.createElement('li');
      item.style = "color:red";
      item.textContent = msg;
      messages.appendChild(item);
      window.scrollTo(0, document.body.scrollHeight);
    });


    // QUIZOO
    socket.on('show house', function(data) {
      console.log(data);
      // reset divjes
      document.getElementById("answers").innerHTML = "";

      // new data
      document.getElementById("question").innerText = data.Title;
      ["a", "b", "c", "d"].forEach(element => {
        var item = document.createElement('li');
        item.textContent = data.Information[element];
        document.getElementById("answers").appendChild(item);
      });

      // reset slider
      slider.value = 50;
    });

    socket.on('finish quiz', function(quizData) {
      document.getElementById("answers").innerHTML = "";
      document.getElementById("question").innerText = "Dat was het!";
    });

    output.innerHTML = slider.value;
    
    slider.oninput = function() {
      output.innerHTML = this.value;
    }
  </script>